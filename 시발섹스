<?php
$link = mysqli_connect("localhost", "root", "", "themepark");

if (!$link) {
    die("DB 연결 실패: " . mysqli_connect_error());
}

if (isset($_POST['submit'])) {
    $category = $_POST['category'];
    $type = $_POST['type'];
    $price = $_POST['price'];
    $note = $_POST['note'];

    $sql = "INSERT INTO tickets (category, type, price, note) 
            VALUES ('$category', '$type', '$price', '$note')";

    mysqli_query($link, $sql);
}

$result = mysqli_query($link, "SELECT * FROM tickets");
?>

<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>놀이공원 이용권</title>
    <style>
        table, th, td { border: 1px solid black; border-collapse: collapse; }
        th, td { padding: 8px; text-align: center; }
    </style>
</head>
<body>
    <h1>이용권 등록</h1>
    <form method="POST">
        <label>구분:
            <select name="category">
                <option>입장권</option>
                <option>BIG3</option>
                <option>자유이용권</option>
                <option>연간이용권</option>
            </select>
        </label>
        <label>대상:
            <select name="type">
                <option>어린이</option>
                <option>어른</option>
            </select>
        </label>
        <label>가격: <input type="number" name="price" required></label>
        <label>비고: <input type="text" name="note" required></label>
        <button type="submit" name="submit">추가</button>
    </form>

    <h2>이용권 목록</h2>
    <table>
        <thead>
            <tr>
                <th>ID</th>
                <th>구분</th>
                <th>대상</th>
                <th>가격</th>
                <th>비고</th>
            </tr>
        </thead>
        <tbody>
            <?php while ($row = mysqli_fetch_assoc($result)): ?>
                <tr>
                    <td><?= $row['id'] ?></td>
                    <td><?= $row['category'] ?></td>
                    <td><?= $row['type'] ?></td>
                    <td><?= number_format($row['price']) ?>원</td>
                    <td><?= $row['note'] ?></td>
                </tr>
            <?php endwhile; ?>
        </tbody>
    </table>
</body>
</html>
<?php
mysqli_close($link);
?>
